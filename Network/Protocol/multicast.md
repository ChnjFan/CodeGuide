# 组播基础

组播是一种一对多/多对多的网路通信方式，发送方将数据发送到一个特定组播地址，只有加入该组的接收设备可以收到数据。

[TOC]

## 基本概念

IP 组播通信是 IP 报文从一个源发出，被转发到一组特定的接收者。

IP 组播可以有效地节约网络带宽、降低网络负载，所以被广泛应用于 IPTV、实时数据传送和多媒体会议等网络业务中。

![](../Pics/multicast.png)

- 组播组：IP 组播地址标识的集合。主机加入组播组成为该组成员，可以识别并接收发往该组播组的组播数据。
- 组播源：信息的发送者 Source。一个组播源可以同时向多个组播组发送数据，多个组播源也可以同时向一个组播组发送报文。组播源通常不需要加入组播组，由源端 DR 负责管理组播源的注册和 SPT（Shortest Path Tree）的建立。
- 组播组成员：加入某组播组的主机，Host A 和 Host C。组播组中的成员是动态的，主机可以在任何时刻加入或离开组播组。组播组成员可以在网络任何地方。
- 组播路由器：支持三层组播功能的路由器或交换机。组播路由器不仅能够提供组播路由功能，也能够在与用户连接的末梢网段上提供组播组成员的管理功能。

### 服务模型

- **ASM（Any-Source Multicast，任意源组播）**：传统的组播服务模型，接收者主机加入组播组以后可以接收到任意源发送到该组的数据。
  - 接收者无需知道具体的源地址就能接收数据；
  - 可能会收到重复的组播流量，而且会同时收到来自多个源的数据，可能导致网络流量拥塞。
- **SSM（Source-Specific Multicast，源特定组播）**：改进的组播服务模型，接收者主机在加入组播组时，可以指定只接收哪些源的数据或指定拒绝接收来自哪些源的数据，主机只会收到指定源发送到该组的数据。

## 组播地址

一个 IP 组播地址标识一组主机接口。

发送组播数据时，发送方使用单播 IP 地址作为源地址，使用组播地址作为目的地址，网络仅转发给加入该组的设备。

组播成员通过 [IGMP 协议](./igmp.md) 或 [MLD 协议](./mld.md) 进行管理。

### IPv4 组播地址

IPv4 地址中的 D 类地址（224.0.0.0~239.255.255.255）保留位组播地址，固定前缀前四位为 `1110`。

- 链路本地组播地址（224.0.0.0 ~ 224.0.0.255）：仅在本地链路（同一网段）传播，不跨路由器转发；用于网络协议交互（如 224.0.0.1 = 所有主机、224.0.0.2 = 所有路由器）。
- 全球范围 ASM 地址（224.0.1.0 ~ 231.255.255.255）：可跨路由传播，支持任意源组播（ASM）；用于公网组播服务（如 224.0.1.1=NTP 时间同步、224.0.1.24 = 组播管理）。
- 全球范围 SSM 地址（232.0.0.0 ~ 232.255.255.255）：专门用于源特定组播（SSM），仅接收指定源的流量；用于直播、企业专属数据分发。
- 组织范围 ASM 地址（233.0.0.0 ~ 238.255.255.255）：跨路由但仅限企业 / 组织内部使用，可重复分配；用于内部组播应用（如视频会议、内部直播）。
- 本地管理组播地址（239.0.0.0 ~ 239.255.255.255）：仅在本地管理域（如企业内网）有效，不可跨外网传播；类似 IPv4 私有单播地址，避免公网冲突。

### IPv6 组播地址

IPv6 组播地址前缀为 ff00::/8，后 112 位可用于保存组号。通过标志字段和范围字段定义传播范围、地址类型和组标识等。

IPv6 组播地址的 128 位的字段结构：

- 固定前缀（8 位）：`FF` 是 IPv6 组播地址的唯一标识，用于区分单播和任播地址。
- 标志位（4 位）：标识组播地址的属性，结构为 `0RPT`。
  - R 位（回合点标志）：0 表示非内嵌 RP 的 IPv6 组播地址；1 表示内嵌 RP 的 IPv6 组播地址， 此时 P、T 位置 1。
  - P 位（前缀标志）：0 表示非基于单播前缀的 IPv6 组播地址；取 1 表示基于单播前缀的 IPv6 组播地址，此时 T 位也必须置 1。
  - T 位（临时标志）：取 0 表示由 IANA 永久分配的 IPv6 组播地址，取 1 表示非永久分配的 IPv6 组播地址。
- 范围字段（4 位）：表示组播数据包的传播范围。
- 组 ID（112 位）：唯一标识特定组播组。

> RP（Rendezvous Point）即汇集点，是 IPv6 PIM 中特有的 RP 发现机制，该机制使用内嵌 RP 地址的 IPv6 组播地址，使得组播路由器可以直接从该地址中解析出 RP 的地址。

### 组播 MAC 地址

以太网传播单播报文目的 MAC 地址是接收者的 MAC 地址。

传输组播数据目的地址是一个成员不确定的组，使用组播 MAC 地址（组播地址映射到链路层的地址）。

#### IPv4 组播 MAC 地址

高 24 位为 0x01005e，第 25 位为 0，低 23 位为 IPv4 组播地址的低 23 位。

#### IPv6 组播 MAC 地址

IPv6 组播 MAC 地址的高 16 位为 0x3333，低 32 位为 IPv6 组播地址的低 32 位。