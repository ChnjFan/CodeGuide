# ARP 协议

ARP（Address Resolution Protocol）地址解析协议是将 IP 地址解析成 MAC 地址的协议，让数据能在局域网内精准找到目标设备。

[TOC]

## 协议报文

ARP 报文封装在链路层帧中，不包含帧头总长度固定为 28 字节。

```bash
+0--------------7--------------15----------------23----------------31
|                Ethernet Address of Destination(0-47)              |
+                                  +--------------------------------|
|                                  |                                |
+----------------------------------+                                |
|                Ethernet Address of Sender(0-47)                   |
+----------------------------------|--------------------------------|
|             Frame Type           |           Hardware Type        |
+----------------------------------|----------------|---------------|
|           Protocol Type          | Hardware Length|Protocol Length|
+----------------------------------|--------------------------------|
|              OP                  |                                |
+----------------------------------+                                |
|                Ethernet Address of Sender(0-47)                   |
+-------------------------------------------------------------------|
|                         IP Address of Sender                      |
+-------------------------------------------------------------------|
|                Ethernet Address of Destination(0-47)              |
+                                  +--------------------------------|
|                                  | IP Address of Destination(0-15)|
+----------------------------------|--------------------------------|
| IP Address of Destination(16-31) |
+----------------------------------|
```

- 目的 MAC 地址（6 字节）：ARP 请求报文为广播报文，值为 0xFFFFFFFFFFFF。
- 源 MAC 地址（6 字节）：请求设备 MAC 地址。
- 帧类型（2 字节）：ARP 请求和应答值为 0x0806。
- 硬件类型（2 字节）：以太网值为0x0001。
- 协议类型（2 字节）：IPv4 值为 0x0800，IPv6 使用 NDP 协议，不依赖 ARP。
- 硬件地址长度（1 字节）：硬件类型以太网 MAC 地址长度 6 字节。
- 协议地址长度（1 字节）：IPv4 地址长度 4 字节。
- 操作码（2 字节）：ARP 请求 0x0001，ARP 应答 0x0002。
- 发送方硬件地址（6 字节）：发送方的 MAC 地址，与源 MAC 地址相同。
- 发送方 IP 地址（4 字节）：发送方的 IP 地址。
- 接收方 MAC 地址（6 字节）：请求报文为全 0，应答报文填写接收方 IP 地址对应设备的 MAC 地址。
- 接收方 IP 地址（4 字节）：接收方的 IP 地址，请求和应答报文都需要填写。

