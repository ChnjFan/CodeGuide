# RIP 协议

RIP（Routing Information Protocol）路由信息协议是一种较为简单的内部网关协议IGP，基于距离矢量（Distance-Vector）算法的经典内部网关协议，主要用于规模较小的网络中，比如校园网以及结构较简单的地区性网络。

[TOC]

## 协议规范

RIP 协议传输层基于 UDP 协议，源/目的端口默认 520，静默进程仅响应非 520 端口的请求。

RIP有两个版本：

- **RIP-1**：有类别路由协议（Classful Routing Protocol），它只支持以广播方式发布协议报文。协议报文中没有携带掩码信息，它只能识别A、B、C类这样的自然网段的路由，因此RIP-1无法支持路由聚合，也不支持不连续子网（Discontiguous Subnet）。
- **RIP-2**：无分类路由协议（Classless Routing Protocol），有两种报文传送方式：广播方式和组播方式，缺省将采用组播方式发送报文，使用的组播地址为224.0.0.9。当接口运行RIP-2广播方式时，也可接收RIP-1的报文。

### RIP-1的报文格式

RIP-1报文由头部（Header）和多个路由表项（Route Entries）部分组成。在一个RIP报文中，最多可以有25个路由表项（受 512 字节限制）。

```bash
0               7              15              23              31
+---------------------------------------------------------------+
|      Command  |  Version     |            Must be zero        |
+---------------------------------------------------------------+
| Address family identifier    |            Must be zero        |
+---------------------------------------------------------------+
|                            IP address                         |
+---------------------------------------------------------------+
|                           Must be zero                        |
+---------------------------------------------------------------+
|                           Must be zero                        |
+---------------------------------------------------------------+
|                             Metric                            |
+---------------------------------------------------------------+
```

- 命令：区分报文类型。
  - Request报文，向邻居请求全部或部分路由信息；
  - Reponse报文，发送自己全部或部分路由信息，一个Response报文中最多包含25个路由表项。
- 版本号：目前版本为 RIP-1 和 RIP-2。
- 地址族标识：2 表示 IP 协议，Request 报文该字段为 0。
- 路由的目的IP地址：自然网段的地址，也可以是子网地址或主机地址。
- 路由的开销值。对于Request报文，此字段值为16（不可达），1-15（有效值）。

### RIP-2的报文格式

```bash
0               7              15              23              31
+---------------------------------------------------------------+
|      Command  |  Version     |            Must be zero        |
+---------------------------------------------------------------+
| Address family identifier    |            Route Tag           |
+---------------------------------------------------------------+
|                           IP Address                          |
+---------------------------------------------------------------+
|                           Subnet Mask                         |
+---------------------------------------------------------------+
|                           Next Hop                            |
+---------------------------------------------------------------+
|                           Metric                              |
+---------------------------------------------------------------+
```

- 外部路由标记
- 目的地址的掩码
- 下一跳地址：提供更好的下一跳地址，如果是 0.0.0.0，则表示发布此路由的路由器地址就是最优下一跳地址。

