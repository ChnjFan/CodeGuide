# 红黑树

红黑树是一种**自平衡二叉查找树（BST）**，保证每次查找、插入、删除的时间复杂度都是 **O(log n)**。

它通过**颜色规则 + 旋转**来维持平衡，不会像普通 BST 那样退化成链表。

[TOC]

## 数据结构

红黑树本质数据结构是自平衡二叉查找树（BST）。

- 二叉查找树满足左子树的数据小于根节点的数据，小于右子树的数据。通过中序遍历是有序序列。
- 通过颜色做平衡标记，通过规则避免单个路径无限长。

## 核心特性

红黑树通过设置规则来保持平衡。

1. 每个节点只能是红色或者黑色。
2. 根节点一定是黑色。根节点如果是红色，容易出现连续的红节点，调整起来复杂。
3. 所有叶子节点（NULL 空节点）都是黑色。空节点作为路径统一的终点，保证每条路径都是黑色节点，统一黑高计算方式。
4. 如果一个节点是红色，它的两个子节点也必须是黑色。
   - 如果红色可以连续，就无法通过黑色节点数量平衡树的层高，造成某条路径全是红色节点。
5. 从任意节点到所有后代叶子节点的路径上，黑色节点数量必须完全相同。

通过固定黑色节点的数量和红色节点不能连续的特性，任何一条路径长度最多是最短路径的 2 倍。

### 增删改查复杂度

红黑树的**查找、插入、删除、修改**操作，**最坏时间复杂度都是 O (log n)**，平均复杂度也接近 O (log n)。

操作复杂度取决于树的层高：

- 最短路径：全黑色节点，长度为 h_b。
- 最长路径：黑色和红色交替，长度为 2 * h_b。

满二叉树的层高为 log(n+1)，黑色节点不可能比满二叉树更密集，所以黑高最大为 log(n+1)。

所有操作都是从更节点到目标节点路径执行，路径长度就是树的高度，所以复杂度为 O(log n)。

#### 查找操作

红黑树本质是二叉查找树，查找逻辑与 BST 一致，复杂度为 O(log n)。

查找效率略低于 AVL 树，但插入和删除效率更高。

#### 插入操作

1. 找到插入位置：查找操作一致。
2. 修复红黑树性质：
   - 插入默认红色节点，可能出现红色连续节点违反规则。
   - 通过左旋+右旋操作，调整指针 O(1) 操作。
   - 向上递归检查到根节点，递归次数为 O(log n)。

